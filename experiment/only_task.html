<!DOCTYPE html>
<html>
    <head>
        <!-- Title shown in tab -->
        <title>Experiment</title>

        <!-- Load JsPsych -->
        <script src="https://unpkg.com/jspsych@8.2.2"></script>
        <link href="https://unpkg.com/jspsych@8.2.2/css/jspsych.css" rel="stylesheet" type="text/css" />

        <!-- Load plugins -->
        <script src="https://unpkg.com/@jspsych/plugin-browser-check@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-preload@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-fullscreen@2.1.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey@3.0.0"></script>
        <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@3.0.0/css/survey.css" />

        <!-- To save data via DataPipe (for online experiments) -->
        <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.5.0"></script>

        <!-- Custom scripts -->
        <script src="stimuli_selection/stimuli_list.js"></script>
        <script src="questionnaires.js"></script>
        <script src="demographics.js"></script>
        <script src="fiction.js"></script>

        <!-- CSS -->

        <style></style>
    </head>

    <body></body>

    <script>
        // Initialize experiment =================================================
        var jsPsych = initJsPsych({
            show_progress_bar: true,
            on_finish: function () {
                // jsPsych.data.displayData("json")
                window.location = "https://realitybending.github.io/"
            },
        })

        // Initialize timeline ---------------------------------------------------
        var timeline = []

        const condition = jsPsych.randomization.shuffle(["Control", "More attractive", "Less attractive", "Self Expectations"])[0]

        // Consent -----------------------------------------------------------
        // timeline.push({ type: jsPsychFullscreen, fullscreen_mode: true })
        timeline.push(fiction_preloadstims)
        // timeline.push(consent_form)

        // Demographics -------------------------------------------------------
        timeline.push(demographics_browser_info)
        // timeline.push(demographics_questions)

        // // Questionnaires -------------------------------------------------------
        questionnaires = [questionnaire_bait, questionnaire_MIST, questionnaire_BRS]
        questionnaires = jsPsych.randomization.shuffle(questionnaires) // Shuffle order of questionnaires
        // timeline.push(questionnaires[0]) // First questionnaire

        // Fiction stage 1 ------------------------------------------------------
        timeline.push(fiction_instructions1)
        // if (condition !== "Control") {
        //     timeline.push(fiction_expectations)
        // }
        timeline.push(fiction_phase1)
        // timeline.push(fiction_feedback1)

        // timeline.push(questionnaires[1]) // Second questionnaire

        //Fiction stage 2 -------------------------------------------------------
        timeline.push(fiction_instructions2)
        timeline.push(fiction_phase2)

        // timeline.push(questionnaires[2]) // Third questionnaire

        // End of experiment ----------------------------------------------------
        // timeline.push(experiment_feedback)
        // timeline.push(demographics_debriefing)

        // Save data via DataPipe ================================================
        // timeline.push({
        //     type: jsPsychPipe,
        //     action: "save",
        //     experiment_id: "3trOIIJGRBPV", // This is generated in the DataPipe interface
        //     filename: `${jsPsych.randomization.randomID(10)}.csv`,
        //     data_string: () => jsPsych.data.get().csv(),
        // })

        // Exit fullscreen mode
        // timeline.push({ type: jsPsychFullscreen, fullscreen_mode: false })
        timeline.push(demographics_endscreen)

        // Run the timeline -------------------------------------------------------
        jsPsych.run(timeline)
    </script>
</html>
